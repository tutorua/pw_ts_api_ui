# pw_ts_api_ui

Framework for API and UI auto-tests using Playwright and Type Script integrated with Allure Reports.

## Project Structure

```
playwright-api-ui-framework/
â”œâ”€â”€ .github/                         # CI workflows (optional)
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ ci.yml
â”œâ”€â”€ allure-results/                  # Generated by Allure after test runs (gitignored)
â”œâ”€â”€ allure-report/                   # Generated HTML report (gitignored)
â”œâ”€â”€ reports/                         # Optional: for screenshots, videos, traces
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”œâ”€â”€ api/                     # API test specs
â”‚   â”‚   â”‚   â””â”€â”€ user.api.spec.ts
â”‚   â”‚   â”œâ”€â”€ ui/                      # UI test specs
â”‚   â”‚   â”‚   â””â”€â”€ login.ui.spec.ts
â”‚   â”‚   â””â”€â”€ utils/                   # Shared utilities/helpers
â”‚   â”‚       â”œâ”€â”€ apiClient.ts
â”‚   â”‚       â””â”€â”€ testData.ts
â”‚   â”œâ”€â”€ pages/                       # Page Object Model (POM) for UI
â”‚   â”‚   â””â”€â”€ LoginPage.ts
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ env.ts                   # Environment config (dev, staging, prod)
â”‚       â””â”€â”€ playwright.config.ts     # Playwright config with Allure reporter
â”œâ”€â”€ .env                             # Environment variables (gitignored)
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ playwright.config.ts             # Root config (symlink or duplicate of src/config)
â”œâ”€â”€ README.md
â””â”€â”€ allure.config.js                 # Optional: Allure config
```

## Step-by-Step Setup Guide

### 1 - Initialize Project & Install Dependencies
```
mkdir playwright-api-ui-framework
cd playwright-api-ui-framework
npm init -y
```
**Install core dependencies:**
```
npm install -D @playwright/test typescript ts-node dotenv
npm install -D allure-playwright allure-commandline
npm install -D @types/node
```
ðŸ’¡ allure-playwright integrates Allure reporting into Playwright.  
ðŸ’¡ allure-commandline lets you generate and serve reports locally.

### 2 - Configure TypeScript
Create tsconfig.json:
```
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["DOM", "ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src/**/*", "playwright.config.ts"],
  "exclude": ["node_modules"]
}
```

### 3 - Environment Configuration
Create .env:
```
BASE_URL=https://reqres.in
UI_BASE_URL=https://example.com
```
Add .env to .gitignore

Create src/config/env.ts:
```
import * as dotenv from 'dotenv';
dotenv.config();

export const config = {
  baseUrl: process.env.BASE_URL || 'http://localhost:3000',
  uiBaseUrl: process.env.UI_BASE_URL || 'http://localhost:4200',
};
```

### 4 - Playwright Configuration with Allure
Create src/config/playwright.config.ts (and optionally symlink or copy to root):
```
import { defineConfig } from '@playwright/test';

export default defineConfig({
  testDir: './src/tests',
  timeout: 30 * 1000,
  expect: {
    timeout: 5000,
  },
  reporter: [
    ['list'],
    ['allure-playwright', { outputFolder: 'allure-results', detail: true }],
  ],
  use: {
    baseURL: process.env.UI_BASE_URL || 'http://localhost:4200',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    // Add firefox, webkit if needed
  ],
});
```
ðŸ’¡ You can symlink it to root for convenience: 
```
bash
ln -s src/config/playwright.config.ts playwright.config.ts
```
### 5 - Allure Report Configuration (Optional)
Create allure.config.js (optional for customizing report name, logo, etc.):
```
module.exports = {
  reportName: 'Playwright API & UI Test Report',
  resultsDir: './allure-results',
  reportDir: './allure-report',
};
```
### 6 - Create Utility for API Testing
Create src/tests/utils/apiClient.ts:
```
import { APIRequestContext } from '@playwright/test';
import { config } from '../../config/env';

export class ApiClient {
  private request: APIRequestContext;

  constructor(request: APIRequestContext) {
    this.request = request;
  }

  async get<T>(endpoint: string): Promise<T> {
    const response = await this.request.get(`${config.baseUrl}${endpoint}`);
    return await response.json();
  }

  async post<T>(endpoint: string, body: any): Promise<T> {
    const response = await this.request.post(`${config.baseUrl}${endpoint}`, {
      data: body,
    });
    return await response.json();
  }

  // Add put, delete as needed
}
```
### 7 - Page Object for UI Testing
```
import { Page } from '@playwright/test';

export class LoginPage {
  readonly page: Page;

  constructor(page: Page) {
    this.page = page;
  }

  async goto() {
    await this.page.goto('/login');
  }

  async login(username: string, password: string) {
    await this.page.fill('input[name="username"]', username);
    await this.page.fill('input[name="password"]', password);
    await this.page.click('button[type="submit"]');
  }

  async getErrorMessage() {
    return await this.page.textContent('.error');
  }
}
```

### 8 - Write Test Specs
**API Test:** src/tests/api/user.api.spec.ts
```
import { test, expect } from '@playwright/test';
import { ApiClient } from '../utils/apiClient';

test.describe('User API Tests', () => {
  let apiClient: ApiClient;

  test.beforeEach(async ({ request }) => {
    apiClient = new ApiClient(request);
  });

  test('should get list of users', async () => {
    const response = await apiClient.get('/api/users?page=2');
    expect(response).toHaveProperty('data');
    expect(Array.isArray(response.data)).toBeTruthy();
  });

  test('should create a new user', async () => {
    const newUser = { name: 'John', job: 'Engineer' };
    const response = await apiClient.post('/api/users', newUser);
    expect(response.name).toBe('John');
    expect(response.job).toBe('Engineer');
  });
});
```
**UI Test:** src/tests/ui/login.ui.spec.ts
```
import { test, expect } from '@playwright/test';
import { LoginPage } from '../../pages/LoginPage';

test.describe('Login Page Tests', () => {
  test('should login successfully', async ({ page }) => {
    const loginPage = new LoginPage(page);
    await loginPage.goto();
    await loginPage.login('validuser', 'validpass');

    await expect(page).toHaveURL('/dashboard');
  });

  test('should show error for invalid credentials', async ({ page }) => {
    const loginPage = new LoginPage(page);
    await loginPage.goto();
    await loginPage.login('invalid', 'invalid');

    const errorMsg = await loginPage.getErrorMessage();
    expect(errorMsg).toContain('Invalid credentials');
  });
});
```

### 9 - Add Scripts to package.json
```
{
  "scripts": {
    "test": "npx playwright test",
    "test:ui": "npx playwright test src/tests/ui",
    "test:api": "npx playwright test src/tests/api",
    "report": "npx allure generate allure-results --clean && npx allure open",
    "lint": "npx eslint . --ext .ts",
    "format": "npx prettier --write ."
  }
}
```

### 10 - Create .gitignore
```
node_modules/
dist/
allure-results/
allure-report/
reports/
.env
.DS_Store
*.log
```

### 11 - Run Tests & Generate Allure Report
```
# Install Playwright browsers (first time)
npx playwright install

# Run all tests
npm run test

# Generate and open Allure report
npm run report
```

Resources:  
Playwright Docs: https://playwright.dev/docs/intro  
Allure Playwright: https://github.com/allure-framework/allure-js/tree/master/packages/allure-playwright  
Allure CLI: https://docs.qameta.io/allure-report/

